<tool id="check_sam_present" name="Check for 2 SAM files - " version="0.1.0">
    <description>verify 2 SAM files are present for every 1 FASTQ file.</description>
    <macros>
        <import>../macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command><![CDATA[
    python '$__tool_directory__/check_sam_present.py'
    --fq=$fq.element_identifier
    --alnType=$alnType
    --sam1=$sam1
    --sam2=$sam2
    --out=$out
]]></command>
    <inputs>
        <param name="alnType" size="30" type="select" value="" display="radio" label="Align Type" help="Select whether SAM files were created from single end or paired end alignments">
            <option value="SE" selected="true">Single end</option>
            <option value="PE" selected="true">Paired end</option>
        </param>
        <param name="sam1" type="data" format="sam" label="Unique SAM for G1" help="Select the SAM file [from BWASplitSAM] for genome 1 containing only uniquely mapped reads."/> 
        <param name="sam2" type="data" format="sam" label="Unique SAM for G2" help="Select the SAM file [from BWASplitSAM] for genome 2 containing uniquely mapped reads. "/>
        <param name="fq" type="data" format="fastq" label="FastQ file" help="Select the FastQ file used to generate alignments and create the input SAM files" />
    </inputs>
    <outputs>
        <data name="out" format="tabular" label="${tool.name} on ${on_string}:Check for 2 SAM Files"/>
    </outputs>
    <tests>
        <test>
            <param name="fq" ftype="data" value="W55_M_1_1.fastq"/>
            <param name="alnType" ftype="select" value="SE"/>
            <param name="sam1" ftype="data"      value="W1118_G1_unique_sam_for_BASE.sam"/>
            <param name="sam2" ftype="data"      value="W55_G2_unique_sam_for_BASE.sam"/>
            <output name="out"       file="check_SAM_present_BASE_test_data.tabular" />
        </test>
    </tests>
    <help><![CDATA[

**Tool Description**

This tool checks to make sure that **2 SAM files** were generated from **1 FASTQ file** (one for each parental genome), and that the SAM file was aligned and parsed correctly. These SAM files are also inspected to ensure that they consist of uniquely mapped reads and that all other reads have been properly removed after the parsing step (BWASplitSAM tool).  

Each FASTQ file is aligned to the updated G1 genome AND to the updated G2 genome, so it is appropriate that 2 SAM files are created. 

**NOTE:**  If you are running the BASE Align and Count workflow without modification, all reads are aligned as Single End - select SE


**Inputs**

**FASTQ File [Required]**

The FASTQ file used to generate the SAM files

**Alignment Type [Required]**

Select from drop-down menu how the FASTQ file was aligned - this will be SE if running the BASE workflow

**2 Unique SAM files [Required]**
-Two unique SAM files that are composed of alignments from uniquely mapped reads on the forward and reverse strands are required. These can be created by the *BWASplitSAM Tool*. 

(1) The unique SAM file generated by alignments to G1
(2) The unique SAM file generated by alignments to G2


**Output**

	(1) A single TSV file containing information on whether 2 SAM files are present per FASTQ file or not. 

Example of output: 

    +-------------------+--------------------------+
    |   fqName          |   message                |
    +===================+==========================+
    |dataset_1795.dat   | Have 2 SAM files - good! | 
    +-------------------+--------------------------+

    ]]></help>
    <citations>
            <citation type="bibtex">@ARTICLE{Miller20BASE,
            author = {Brecca Miller, Alison M. Morse, Elyse Borgert, Zihao Liu, Kelsey Sinclair, Gavin Gamble, Fei Zou, Jeremy Newman, Luis Leon Novello, Fabio Marroni, Lauren M. McIntyre},
            title = {Testcrosses are an efficient strategy for identifying cis regulatory variation: Bayesian analysis of allele imbalance among conditions (BASE)},
            journal = {????},
            year = {submitted for publication}
            }</citation>
        </citations>
</tool>
