<tool id="base_remove_nonoverlapping_reads" name="Remove reads"  version="0.1.0">
    <description>that do not overlap with genic features for BASE (using awk)</description>
    <macros>
        <import>../macros.xml</import>
    </macros>
    <requirements>
    </requirements>
    <command>
<![CDATA[
	 mkdir outputs;
	 cd outputs;
	 echo "sampleID	number_overlapping_rows	total_number_rows" > $summary;
	 #for $f in $BEDINT# 
	 awk -v OFS='    ' '$4 !="."' '$f' > '$f.element_identifier';
	 awk -v a=0 '{if($4 !=".") a++} END{print "$f.element_identifier""\t"a"\t"NR }' '$f' >> $summary;
	 #end for;

]]>
    </command>
    <inputs>
      <param name="BEDINT" type="data" format="tabular" multiple="true" label="Output from Bedtools Intersect Intervals" />
    </inputs>
    <outputs>
      <collection name="split_output" type="list" label="${tool.name} on ${on_string}: collection">
        <discover_datasets pattern="(?P&lt;name&gt;.*)" ext="tabular" directory="outputs" />
      </collection>
      <data name="summary" format="tabular" label="${tool.name} on ${on_string} summary output"/>
    </outputs>
    <tests>
        <test>
            <param name="BEDINT" ftype="data"     value="bedtools_intersect_intervals_BASE_test_data.bed"/>
            <output name="BED3"  ftype="data"      file="drop_nonintersecting_reads_for_BASE.tabular" />
        </test>
    </tests>    
    <help><![CDATA[
    **Tool Description**

The purpose of this tool is to remove reads from the input BED file that do not intersect with any genic features.
The input into this tool is generated by the **BedTools Intersect Intervals** and may contain rows where a read does not intersect with any genic features.  These rows contain a “.” in the ThickStart column. 
The resulting output BED file contains locations of unique reads that overlap with regions of genic features. 
  
-----------------------------------------------------------------------------------------------

**Inputs**
    -One input dataset is required. 

**BED File [REQUIRED]**
   
 -A BED file resulting from the intersection of a SAM file in BED format and a BED file of genic features.  
        This input BED file can be generated with the **BedTools Intersect Intervals** tool.  

Example input BED file:

    +-------------+---------+---------+---------+---------+------------+------------+
    |   Chrom     |  Start  |   End   |   Name  |  Score  | Strand     |ThickStart  |
    +=============+=========+=========+=========+=========+============+============+
    |      X      |  2190   |  2245   |   X     |    1    | 2300       |l(1)G0196   |
    +-------------+---------+---------+---------+---------+------------+------------+
    |      2R     |  1502   |  1834   |   2R    |     50  | 1900       | Mapmodulin |
    +-------------+---------+---------+---------+---------+------------+------------+
    |      2R     |  1621   |  1680   |    .    |  -1     |-1          |.           |
    +-------------+---------+---------+---------+---------+------------+------------+
    


**Outputs**
    The tool outputs a BED file containing regions of reads that overlap with locations of genic features interest.

Example output BED file:

    +---------------+---------+---------+---------+---------+------------+------------+
    |   Chrom       |  Start  |   End   |   Name  |  Score  | Strand     |ThickStart  |
    +===============+=========+=========+=========+=========+============+============+
    |      X        |  2190   |  2245   |   X     |    1    |    2300    |l(1)G0196   |
    +---------------+---------+---------+---------+---------+------------+------------+
    |      2R       |  1502   |  1834   |   2R    |     50  |19000       |Mapmodulin  |
    +---------------+---------+---------+---------+---------+------------+------------+
    ]]></help>
    <citations>
            <citation type="bibtex">@ARTICLE{Miller20BASE,
            author = {Brecca Miller, Alison M. Morse, Elyse Borgert, Zihao Liu, Kelsey Sinclair, Gavin Gamble, Fei Zou, Jeremy Newman, Luis Leon Novello, Fabio Marroni, Lauren M. McIntyre},
            title = {Testcrosses are an efficient strategy for identifying cis regulatory variation: Bayesian analysis of allele imbalance among conditions (BASE)},
            journal = {????},
            year = {submitted for publication}
            }</citation>
        </citations>
</tool>
